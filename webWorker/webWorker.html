<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <title>webWorker | yangzhenqian</title><meta name="description" content="hello">
    <link rel="preload" href="/assets/js/runtime~app.30202cd1.js" as="script"><link rel="preload" href="/assets/css/styles.113454fc.css" as="style"><link rel="preload" href="/assets/js/567.ff38b5b2.js" as="script"><link rel="preload" href="/assets/js/app.bbee2ec2.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.113454fc.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">yangzhenqian</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item">关于我</p><ul class=""><li><!--[--><a href="/my/" class="nav-link sidebar-item" aria-label="关于我"><!--[--><!--]--> 关于我 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">css高级</p><ul class=""><li><!--[--><a href="/css/render.html" class="nav-link sidebar-item" aria-label="浏览器渲染原理"><!--[--><!--]--> 浏览器渲染原理 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">js高级</p><ul class=""><li><!--[--><a href="/js-advanced/%E5%9F%BA%E7%A1%80.html" class="nav-link sidebar-item" aria-label="基础"><!--[--><!--]--> 基础 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/js-advanced/this.html" class="nav-link sidebar-item" aria-label="this 的理解"><!--[--><!--]--> this 的理解 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/js-advanced/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF.html" class="nav-link sidebar-item" aria-label="事件循环机制（event loop）"><!--[--><!--]--> 事件循环机制（event loop） <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/js-advanced/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98.html" class="nav-link sidebar-item" aria-label="浏览器缓存"><!--[--><!--]--> 浏览器缓存 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/js-advanced/%E5%8E%9F%E5%9E%8B%E4%B8%8E%E5%8E%9F%E5%9E%8B%E9%93%BE.html" class="nav-link sidebar-item" aria-label="原型与原型链"><!--[--><!--]--> 原型与原型链 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/js-advanced/%E7%BB%A7%E6%89%BF.html" class="nav-link sidebar-item" aria-label="继承"><!--[--><!--]--> 继承 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/js-advanced/%E5%B8%B8%E8%A7%81%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html" class="nav-link sidebar-item" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/js-advanced/%E6%89%8B%E5%86%99%E6%BA%90%E7%A0%81.html" class="nav-link sidebar-item" aria-label="手写源码以及实现各种功能"><!--[--><!--]--> 手写源码以及实现各种功能 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">路由</p><ul class=""><li><!--[--><a href="/router/" class="nav-link sidebar-item" aria-label="前端路由"><!--[--><!--]--> 前端路由 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">vue</p><ul class=""><li><!--[--><a href="/vue/vue2.html" class="nav-link sidebar-item" aria-label="vue2"><!--[--><!--]--> vue2 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/vue/vue3.html" class="nav-link sidebar-item" aria-label="vue3"><!--[--><!--]--> vue3 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">react</p><ul class=""><li><!--[--><a href="/react/" class="nav-link sidebar-item" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/react/react.html" class="nav-link sidebar-item" aria-label="正篇"><!--[--><!--]--> 正篇 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/react/hooks.html" class="nav-link sidebar-item" aria-label="hooks"><!--[--><!--]--> hooks <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">vite</p><ul class=""><li><!--[--><a href="/vite/" class="nav-link sidebar-item" aria-label="为什么选 vite"><!--[--><!--]--> 为什么选 vite <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/vite/debug.html" class="nav-link sidebar-item" aria-label="debug 源码"><!--[--><!--]--> debug 源码 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">node</p><ul class=""><li><!--[--><a href="/node/node.html" class="nav-link sidebar-item" aria-label="前言"><!--[--><!--]--> 前言 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">工程化</p><ul class=""><li><!--[--><a href="/engineering/webpack.html" class="nav-link sidebar-item" aria-label="webpack"><!--[--><!--]--> webpack <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/engineering/babel.html" class="nav-link sidebar-item" aria-label="babel"><!--[--><!--]--> babel <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/engineering/multirepo&amp;monorepo.html" class="nav-link sidebar-item" aria-label="multi-repo &amp; mono-repo"><!--[--><!--]--> multi-repo &amp; mono-repo <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">electron</p><ul class=""><li><!--[--><a href="/electron/electron.html" class="nav-link sidebar-item" aria-label="electron"><!--[--><!--]--> electron <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">threejs</p><ul class=""><li><!--[--><a href="/threejs/three.html" class="nav-link sidebar-item" aria-label="threejs"><!--[--><!--]--> threejs <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">git</p><ul class=""><li><!--[--><a href="/git/git.html" class="nav-link sidebar-item" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">技术网址</p><ul class=""><li><!--[--><a href="/technicalUrl/url.html" class="nav-link sidebar-item" aria-label="有用的网址"><!--[--><!--]--> 有用的网址 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">chrome</p><ul class=""><li><!--[--><a href="/chrome/plugin.html" class="nav-link sidebar-item" aria-label="谷歌扩展程序"><!--[--><!--]--> 谷歌扩展程序 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/chrome/chromePlugin.html" class="nav-link sidebar-item" aria-label="好用的chrome插件"><!--[--><!--]--> 好用的chrome插件 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item active">webWorker</p><ul class=""><li><!--[--><a aria-current="page" href="/webWorker/webWorker.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="webWorker"><!--[--><!--]--> webWorker <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/webWorker/webWorker.html#产生的背景" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="产生的背景"><!--[--><!--]--> 产生的背景 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/webWorker/webWorker.html#webworker简介" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="webWorker简介"><!--[--><!--]--> webWorker简介 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/webWorker/webWorker.html#兼容性" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="兼容性"><!--[--><!--]--> 兼容性 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/webWorker/webWorker.html#webworker使用" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="webWorker使用"><!--[--><!--]--> webWorker使用 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/webWorker/webWorker.html#创建" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="创建"><!--[--><!--]--> 创建 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/webWorker/webWorker.html#通信" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="通信"><!--[--><!--]--> 通信 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/webWorker/webWorker.html#监听错误" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="监听错误"><!--[--><!--]--> 监听错误 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/webWorker/webWorker.html#关闭" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="关闭"><!--[--><!--]--> 关闭 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/webWorker/webWorker.html#worker引入其他文件" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="worker引入其他文件"><!--[--><!--]--> worker引入其他文件 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/webWorker/webWorker.html#esmodule-模式" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ESModule 模式"><!--[--><!--]--> ESModule 模式 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/webWorker/webWorker.html#有了-web-worker-api-javascript-是否真的变成了一门多线程语言" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="有了 Web Worker API，JavaScript 是否真的变成了一门多线程语言？"><!--[--><!--]--> 有了 Web Worker API，JavaScript 是否真的变成了一门多线程语言？ <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/webWorker/webWorker.html#sharedworker" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="SharedWorker"><!--[--><!--]--> SharedWorker <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/webWorker/webWorker.html#sharedworker调试" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="sharedWorker调试"><!--[--><!--]--> sharedWorker调试 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/webWorker/webWorker.html#兼容性-1" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="兼容性"><!--[--><!--]--> 兼容性 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/webWorker/webWorker.html#serviceworker" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="serviceWorker"><!--[--><!--]--> serviceWorker <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">通信</p><ul class=""><li><!--[--><a href="/http/http.html" class="nav-link sidebar-item" aria-label="http"><!--[--><!--]--> http <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/http/websocket.html" class="nav-link sidebar-item" aria-label="websocket"><!--[--><!--]--> websocket <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/http/eventSource.html" class="nav-link sidebar-item" aria-label="EventSource"><!--[--><!--]--> EventSource <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">正则</p><ul class=""><li><!--[--><a href="/zhengze/zhengze.html" class="nav-link sidebar-item" aria-label="正则"><!--[--><!--]--> 正则 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">前端代理</p><ul class=""><li><!--[--><a href="/httpProxy/chromeProxy.html" class="nav-link sidebar-item" aria-label="前端代理解决方案"><!--[--><!--]--> 前端代理解决方案 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">格式化代码</p><ul class=""><li><!--[--><a href="/formatCode/husky.html" class="nav-link sidebar-item" aria-label="husky"><!--[--><!--]--> husky <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">rust</p><ul class=""><li><!--[--><a href="/rust/rust.html" class="nav-link sidebar-item" aria-label="rust"><!--[--><!--]--> rust <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">开源组态库</p><ul class=""><li><!--[--><a href="/openSource/aj-report.html" class="nav-link sidebar-item" aria-label="aj-report"><!--[--><!--]--> aj-report <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/openSource/h5-dooring.html" class="nav-link sidebar-item" aria-label="h5-dooring"><!--[--><!--]--> h5-dooring <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">vscode</p><ul class=""><li><!--[--><a href="/vscode/plugins.html" class="nav-link sidebar-item" aria-label="插件"><!--[--><!--]--> 插件 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="webworker" tabindex="-1"><a class="header-anchor" href="#webworker" aria-hidden="true">#</a> webWorker</h1><h2 id="产生的背景" tabindex="-1"><a class="header-anchor" href="#产生的背景" aria-hidden="true">#</a> 产生的背景</h2><p>随着Web技术的不断演进，JavaScript的单线程模型已经无法满足日益复杂的业务需求和以及带来的性能要求。为了解决这些问题，JavaScript引入了一些如ajax、setTimeout、requestAnimationFrame等机制，但需要明确的是，这些机制不过是通过EventLoop来制造的多线程假象，其并没有改变JavaScript单线程的本质。 至今，现代Web应用中用户交互变得越来越复杂，以及数据处理需求的增加，JavaScript应用需要更强的计算能力和更快的响应性，单线程模型面临着着挑战愈发严重。这就引出了一个关键问题：如何在保持JavaScript的单线程特性的同时，充分利用多核处理器来提高性能以满足用户的需求？在这样的背景下，Web Worker技术应运而生。</p><h2 id="webworker简介" tabindex="-1"><a class="header-anchor" href="#webworker简介" aria-hidden="true">#</a> webWorker简介</h2><p>Web Workers 是一种在浏览器中运行的 JavaScript 脚本，可以在后台线程中执行，独立于主线程。它们提供了一种并行处理任务的方式，可以提高网页的性能和响应性。 Web Workers 可以执行耗时的计算、处理大量数据、执行复杂的算法等任务，而不会阻塞主线程，从而保持页面的流畅性。</p><ul><li>Worker 线程是在浏览器环境中被唤起，但是它与当前页面窗口运行在不同的全局上下文中；</li><li>顶层对象 window，以及 parent 对象在 Worker 线程上下文中是不可用的；</li><li>Worker 线程上下文中，操作 DOM 的行为也是不可行的，document对象也不存在；</li><li>location和navigator对象可以以可读方式访问；</li><li>绝大多数 Window 对象上的方法和属性，都被共享到 Worker 上下文全局对象 WorkerGlobalScope 中；</li><li>Worker 线程上下文也存在一个顶级对象 self；</li><li>与主线程通信需借助postmessage</li></ul><h2 id="兼容性" tabindex="-1"><a class="header-anchor" href="#兼容性" aria-hidden="true">#</a> 兼容性</h2><p><img src="/assets/img/image.efe10bc4.png" alt=""></p><h2 id="webworker使用" tabindex="-1"><a class="header-anchor" href="#webworker使用" aria-hidden="true">#</a> webWorker使用</h2><h3 id="创建" tabindex="-1"><a class="header-anchor" href="#创建" aria-hidden="true">#</a> 创建</h3><p>options配置</p><ul><li>name 可选，主要用于调试</li><li>type 可选 <ol><li>classic 默认</li><li>module 如果加载为ESModule类型文件，则设置该值</li></ol></li><li>credentials 可选 <ol><li>默认omit不需要携带凭证，</li><li>&quot;same-origin&quot;:仅在请求与当前页面具有相同的源（origin）时发送凭据信息。</li><li>&quot;include&quot; : 总是发送凭据信息，即使跨域请求。</li></ol></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> myWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">&#39;./work.js&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;work&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;classic || module&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">&#39;omit&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="通信" tabindex="-1"><a class="header-anchor" href="#通信" aria-hidden="true">#</a> 通信</h3><p>主线程与worker线程相互独立，通信需要借助postmessage</p><ul><li>参数不可以是callback回调函数</li><li>无法共享内存： 与传统多线程编程不同，Web Worker不能直接共享内存，主页面与worker之间的数据传递的是通过拷贝而不是共享来完成的。因此在如大文件传输场景下可能会消耗大量内存和处理时间。</li><li>数据序列化问题： 当主线程与Web Worker之间在数据交换时需要对数据进行序列化和反序列化，序列化会阻塞发送方，而反序列化会阻塞接收方。</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 主线程</span>
<span class="token keyword">const</span> myWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">&#39;./worker.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 发</span>
myWorker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">&#39;hello&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//收</span>
myWorker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//worker线程</span>
<span class="token comment">// 发</span>
self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">&#39;hello&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 收</span>
self<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="监听错误" tabindex="-1"><a class="header-anchor" href="#监听错误" aria-hidden="true">#</a> 监听错误</h3><ul><li>error 监听worker内部错误</li><li>messageError 监听传输数据无法被解析的时候抛出</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 主线程</span>
<span class="token keyword">const</span> myWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">&#39;/worker.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建worker</span>
myWorker<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myWorker<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;messageerror&#39;</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// worker线程</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;messageerror&#39;</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="关闭" tabindex="-1"><a class="header-anchor" href="#关闭" aria-hidden="true">#</a> 关闭</h3><p>worker 线程的关闭在主线程和 worker 线程都能进行操作，但对 worker 线程的影响略有不同。</p><ul><li>关闭两种方式 <ol><li>myWorker.terminate() 主线程主动关闭</li><li>self.close() worker线程主动关闭</li></ol></li><li>两者相同点 <ol><li>worker 线程当前的 Event Loop 中的任务会继续执行</li><li>下一个EventLoop任务不再理会</li></ol></li><li>不同点 <ol><li>主线程主动关闭，之间的链接会立即关闭，及时当前EventLoop中存在未执行的postMessage消息，主进程也不会收到改消息</li><li>worker进程关闭，不会立即断开链接，会等到当前EventLoop任务执行完成再断开链接，当前EventLoop 同步任务，微任务中存在PostMessage，主进程依然会收到消息</li></ol></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 主线程</span>
<span class="token keyword">const</span> myWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">&#39;/worker.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建worker</span>
myWorker<span class="token punctuation">.</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关闭worker</span>
<span class="token comment">// worker线程</span>
self<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="worker引入其他文件" tabindex="-1"><a class="header-anchor" href="#worker引入其他文件" aria-hidden="true">#</a> worker引入其他文件</h3><p>如果逻辑繁琐，代码体量较大，都写在一个文件，会造成阅读成本较大，代码逻辑混乱等问题，因此就需要引入其他文件，将其他文件的代码引入到worker中，实现逻辑的复用 worker线程中使用importScripts来引入其他js文件，通过该方法引入的文件不受同源策略的限制</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// utils.js</span>
<span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token comment">// worker.js（worker线程）</span>
<span class="token comment">// 使用方法：importScripts(path1, path2, ...); </span>
<span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">&#39;./utils.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// log 3</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="esmodule-模式" tabindex="-1"><a class="header-anchor" href="#esmodule-模式" aria-hidden="true">#</a> ESModule 模式</h3><p>当js文件为ESModule写法时，使用importScripts()直接引入会报错，此时就需要初始化时将第二个参数设置为module</p><p>原生js引入ESModule类型文件</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./worker.js&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;module&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 主线程</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">&#39;/worker.js&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;module&#39;</span>  <span class="token comment">// 指定 worker.js 的类型</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// utils.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token comment">// worker线程</span>
<span class="token keyword">import</span> add <span class="token keyword">from</span> <span class="token string">&#39;./utils.js&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 导入外部js</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;message&#39;</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token function">postMessage</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// log 3</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> self<span class="token punctuation">;</span> <span class="token comment">// 只需把顶级对象self暴露出去即可</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="有了-web-worker-api-javascript-是否真的变成了一门多线程语言" tabindex="-1"><a class="header-anchor" href="#有了-web-worker-api-javascript-是否真的变成了一门多线程语言" aria-hidden="true">#</a> 有了 Web Worker API，JavaScript 是否真的变成了一门多线程语言？</h3><p>从底层技术角度来看，Web Worker确实具备多线程的特性。然而这与传统多线程编程语言（如Java或C++）有所不同。如，JavaScript中的主线程与Web Worker之间采用的是消息传递来通信，而不是直接共享内存。这意味着Web Worker之间无法直接共享数据，而传统多线程语言则可以直接共享内存，从而实现更直接和高效的线程间通信。 尽管Web Worker从底层技术上看具备多线程的特性，但如今JavaScript的主要应用领域仍然是处理用户界面和用户交互，Web Worker的引入主要是为了改善前端应用的响应性，使其能够更好地处理一些计算密集型任务，而不是将JavaScript彻底转变为多线程编程语言。 总结而言，尽管Web Worker API为JavaScript提供了一定程度的多线程支持，但JavaScript仍然是一门主要依赖于单线程执行的编程语言，Web Worker并没有改变JavaScript的单线程本质。</p><h2 id="sharedworker" tabindex="-1"><a class="header-anchor" href="#sharedworker" aria-hidden="true">#</a> SharedWorker</h2><p>可被多个页面共享的特殊的worker进程</p><ul><li>注意点 <ol><li>全局作用域 SharedWorkerGlobalScope，但是继承自WorkerGlobalScope</li><li>SharedWorker 线程的创建和使用跟 worker 类似，事件和方法也基本一样</li><li>主线程与 SharedWorker 线程是通过MessagePort建立起链接，数据通讯方法都挂载在SharedWorker.port上</li><li>采用 addEventListener 来接收 message 事件，那么在主线程初始化SharedWorker() 后，还要调用 SharedWorker.port.start() 方法来手动开启端口</li><li>多个通信页面通信必须同源</li></ol></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 使用addEventListener监听，需要port开启端口</span>
<span class="token comment">// 主线程</span>
<span class="token keyword">const</span> myWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SharedWorker</span><span class="token punctuation">(</span><span class="token string">&#39;./sharedWorker.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myWorker<span class="token punctuation">.</span>port<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 开启端口</span>
myWorker<span class="token punctuation">.</span>port<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;message&#39;</span><span class="token punctuation">,</span> <span class="token parameter">msg</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 使用onmessage接收消息</span>
<span class="token comment">// 主线程</span>
<span class="token keyword">const</span> myWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SharedWorker</span><span class="token punctuation">(</span><span class="token string">&#39;./sharedWorker.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myWorker<span class="token punctuation">.</span>port<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token parameter">msg</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="sharedworker调试" tabindex="-1"><a class="header-anchor" href="#sharedworker调试" aria-hidden="true">#</a> sharedWorker调试</h3><p>在 sharedWorker 线程里使用 console 打印信息，不会出现在主线程的的控制台中。如果你想调试 sharedWorker，需要在 Chrome 浏览器输入 chrome://inspect/ ，这里能看到所有正在运行的 sharedWorker，然后开启一个独立的 dev-tool 面板。 <img src="/assets/img/image-1.a7f8d36d.png" alt=""></p><h3 id="兼容性-1" tabindex="-1"><a class="header-anchor" href="#兼容性-1" aria-hidden="true">#</a> 兼容性</h3><p>sharedWorker 在 Safari 以及移动端的兼容性不是很好 <img src="/assets/img/image-2.f1c5a53a.png" alt=""></p><h2 id="serviceworker" tabindex="-1"><a class="header-anchor" href="#serviceworker" aria-hidden="true">#</a> serviceWorker</h2><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">2023-12-8 4:43:26 ├F10: PM┤</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: zhenqian.yang@i-tage.com">yangzhenqian</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.30202cd1.js" defer></script><script src="/assets/js/567.ff38b5b2.js" defer></script><script src="/assets/js/app.bbee2ec2.js" defer></script>
  </body>
</html>
