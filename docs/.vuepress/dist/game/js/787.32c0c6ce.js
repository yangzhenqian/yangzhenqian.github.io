"use strict";(self["webpackChunkgame"]=self["webpackChunkgame"]||[]).push([[787],{8528:function(e,t,s){s.r(t),s.d(t,{default:function(){return O}});var o=s(3396),i=s(7139),a=s(9242);const n=e=>((0,o.dD)("data-v-819e3c32"),e=e(),(0,o.Cn)(),e),l={class:"game-2048"},r={class:"game-header"},c={class:"score-container"},h={class:"current-score"},d=n((()=>(0,o._)("div",{class:"label"},"得分",-1))),u={class:"score"},w={class:"best-score"},v=n((()=>(0,o._)("div",{class:"label"},"最高分",-1))),g={class:"score"},m={class:"controls"},f=["disabled"],p={class:"grid-container"},y={class:"tile-container"},S={key:0,class:"game-over"},_=n((()=>(0,o._)("div",{class:"message"},"游戏结束!",-1))),b={key:1,class:"game-won"},k=n((()=>(0,o._)("div",{class:"message"},[(0,o.Uk)(" 恭喜获胜! "),(0,o._)("div",{class:"sub-message"},"继续挑战更高分数？")],-1))),T={class:"buttons"},M=n((()=>(0,o._)("div",{class:"game-intro"},[(0,o._)("p",null,"使用方向键或WASD移动方块，相同数字的方块相撞时会合并。"),(0,o._)("p",null,"达到2048即可获胜！")],-1)));function $(e,t,s,n,$,z){return(0,o.wg)(),(0,o.iD)("div",l,[(0,o._)("div",r,[(0,o._)("div",c,[(0,o._)("div",h,[d,(0,o._)("div",u,(0,i.zw)($.score),1)]),(0,o._)("div",w,[v,(0,o._)("div",g,(0,i.zw)($.bestScore),1)])]),(0,o._)("div",m,[(0,o._)("button",{onClick:t[0]||(t[0]=(...e)=>z.newGame&&z.newGame(...e)),class:"new-game"},"新游戏"),(0,o._)("button",{onClick:t[1]||(t[1]=(...e)=>z.undoMove&&z.undoMove(...e)),disabled:!z.canUndo,class:"undo"}," 撤销 ",8,f)])]),(0,o._)("div",{class:"game-container",tabindex:"0",ref:"gameBoard",onKeydown:t[5]||(t[5]=(0,a.iM)(((...e)=>z.handleKeydown&&z.handleKeydown(...e)),["prevent"])),onTouchstart:t[6]||(t[6]=(...e)=>z.handleTouchStart&&z.handleTouchStart(...e)),onTouchmove:t[7]||(t[7]=(...e)=>z.handleTouchMove&&z.handleTouchMove(...e)),onTouchend:t[8]||(t[8]=(...e)=>z.handleTouchEnd&&z.handleTouchEnd(...e))},[(0,o._)("div",p,[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)(4,(e=>(0,o._)("div",{key:"row-"+e,class:"grid-row"},[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)(4,(t=>(0,o._)("div",{key:"cell-"+e+"-"+t,class:"grid-cell"}))),64))]))),64))]),(0,o._)("div",y,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)($.tiles,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:(0,i.C_)(["tile",[`tile-${e.value}`,{"tile-new":e.isNew},{"tile-merged":e.merged}]]),style:(0,i.j5)(z.getTileStyle(e))},(0,i.zw)(e.value),7)))),128))]),$.gameOver?((0,o.wg)(),(0,o.iD)("div",S,[_,(0,o._)("button",{onClick:t[2]||(t[2]=(...e)=>z.newGame&&z.newGame(...e))},"再玩一次")])):(0,o.kq)("",!0),$.won&&!$.keepPlaying?((0,o.wg)(),(0,o.iD)("div",b,[k,(0,o._)("div",T,[(0,o._)("button",{onClick:t[3]||(t[3]=e=>$.keepPlaying=!0)},"继续游戏"),(0,o._)("button",{onClick:t[4]||(t[4]=(...e)=>z.newGame&&z.newGame(...e))},"重新开始")])])):(0,o.kq)("",!0)],544),M])}s(7658);var z={name:"TwentyFortyEight",data(){return{size:4,tiles:[],score:0,bestScore:0,gameOver:!1,won:!1,keepPlaying:!1,history:[],touchStartX:0,touchStartY:0}},computed:{canUndo(){return this.history.length>0}},mounted(){this.loadBestScore(),this.newGame(),this.$refs.gameBoard.focus()},methods:{newGame(){this.tiles=[],this.score=0,this.gameOver=!1,this.won=!1,this.keepPlaying=!1,this.history=[],this.addRandomTile(),this.addRandomTile()},addRandomTile(){const e=this.getEmptyCells();if(e.length){const{row:t,col:s}=e[Math.floor(Math.random()*e.length)],o=Math.random()<.9?2:4;this.tiles.push({id:Date.now()+Math.random(),row:t,col:s,value:o,isNew:!0,merged:!1})}},getEmptyCells(){const e=[],t=new Set(this.tiles.map((e=>`${e.row},${e.col}`)));for(let s=0;s<this.size;s++)for(let o=0;o<this.size;o++)t.has(`${s},${o}`)||e.push({row:s,col:o});return e},getTileStyle(e){const t=100,s=10;return{transform:`translate(${e.col*(t+s)}px, ${e.row*(t+s)}px)`,transition:"transform 0.15s ease-in-out"}},handleKeydown(e){const t=e.key.toLowerCase(),s={arrowup:"up",arrowdown:"down",arrowleft:"left",arrowright:"right",w:"up",s:"down",a:"left",d:"right"},o=s[t];o&&this.move(o)},handleTouchStart(e){const t=e.touches[0];this.touchStartX=t.clientX,this.touchStartY=t.clientY},handleTouchMove(e){e.preventDefault()},handleTouchEnd(e){const t=e.changedTouches[0],s=t.clientX-this.touchStartX,o=t.clientY-this.touchStartY;(Math.abs(s)>30||Math.abs(o)>30)&&(Math.abs(s)>Math.abs(o)?this.move(s>0?"right":"left"):this.move(o>0?"down":"up"))},move(e){if(this.gameOver)return;this.saveState();const t={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}},s=t[e];let o=!1;const i=[],a=new Set,n=[];for(let l=0;l<this.size;l++)for(let t=0;t<this.size;t++)n.push({row:"up"===e?l:"down"===e?this.size-1-l:t,col:"left"===e?t:"right"===e?this.size-1-t:l});n.forEach((e=>{const t=this.tiles.find((t=>t.row===e.row&&t.col===e.col));if(!t)return;let{row:n,col:l}=t,r=n+s.y,c=l+s.x;while(r>=0&&r<this.size&&c>=0&&c<this.size){const e=this.tiles.find((e=>e.row===r&&e.col===c));if(e){if(e.value!==t.value||a.has(`${r},${c}`))break;n=r,l=c,t.value*=2,this.score+=t.value,a.add(`${n},${l}`),o=!0,2048!==t.value||this.won||(this.won=!0);break}n=r,l=c,o=!0,r+=s.y,c+=s.x}a.has(`${n},${l}`)||i.push({...t,row:n,col:l,isNew:!1,merged:a.has(`${n},${l}`)})})),o&&(this.tiles=i,this.addRandomTile(),this.score>this.bestScore&&(this.bestScore=this.score,localStorage.setItem("2048BestScore",this.bestScore)),this.canMove()||(this.gameOver=!0))},canMove(){if(this.getEmptyCells().length)return!0;for(let e=0;e<this.size;e++)for(let t=0;t<this.size;t++){const s=this.tiles.find((s=>s.row===e&&s.col===t));if(s){const o=[{row:e-1,col:t},{row:e+1,col:t},{row:e,col:t-1},{row:e,col:t+1}];for(const e of o){const t=this.tiles.find((t=>t.row===e.row&&t.col===e.col));if(t&&t.value===s.value)return!0}}}return!1},saveState(){this.history.push({tiles:JSON.parse(JSON.stringify(this.tiles)),score:this.score,gameOver:this.gameOver,won:this.won})},undoMove(){if(this.canUndo){const e=this.history.pop();this.tiles=e.tiles,this.score=e.score,this.gameOver=e.gameOver,this.won=e.won}},loadBestScore(){const e=localStorage.getItem("2048BestScore");this.bestScore=e?parseInt(e):0}}},C=s(89);const D=(0,C.Z)(z,[["render",$],["__scopeId","data-v-819e3c32"]]);var O=D}}]);